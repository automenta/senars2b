<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senars3 Cognitive System - Interactive Demo</title>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #f5f7fa;
            --dark: #333;
            --gray: #7f8c8d;
            --border: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background: linear-gradient(135deg, var(--secondary), #1a2530);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .card-title {
            font-size: 1.5rem;
            color: var(--secondary);
        }
        
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
        }
        
        .btn-secondary:hover {
            background-color: #1a2530;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        textarea, input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
        }
        
        textarea {
            min-height: 120px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .demo-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .demo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        
        .demo-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .demo-card p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .output-section {
            background: #2c3e50;
            color: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .output-item {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            background-color: rgba(255,255,255,0.1);
        }
        
        .output-item.belief {
            border-left: 4px solid var(--success);
        }
        
        .output-item.goal {
            border-left: 4px solid var(--danger);
        }
        
        .output-item.query {
            border-left: 4px solid var(--warning);
        }
        
        .item-type {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8em;
            margin-bottom: 5px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: var(--secondary);
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-connected {
            background-color: var(--success);
        }
        
        .status-disconnected {
            background-color: var(--danger);
        }
        
        .notification {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: white;
        }
        
        .notification.success {
            background-color: var(--success);
        }
        
        .notification.error {
            background-color: var(--danger);
        }
        
        .notification.warning {
            background-color: var(--warning);
        }
        
        .system-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: #e9ecef;
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            margin-top: 30px;
            border-top: 1px solid var(--border);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .system-stats {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Senars3 Cognitive System</h1>
            <p class="tagline">A verifiable, goal-directed, and self-reflective reasoning system with hybrid symbolic and semantic cognition</p>
        </header>
        
        <div class="status-bar">
            <div>
                Connection Status: 
                <span id="connection-status">
                    <span class="status-indicator status-disconnected"></span>
                    Disconnected
                </span>
            </div>
            <div>Agenda Size: <span id="agenda-size">0</span></div>
        </div>
        
        <div id="notification-container"></div>
        
        <div class="tabs">
            <div class="tab active" data-tab="demo">Interactive Demos</div>
            <div class="tab" data-tab="custom">Custom Input</div>
            <div class="tab" data-tab="system">System Status</div>
            <div class="tab" data-tab="help">Help & Examples</div>
        </div>
        
        <div class="tab-content active" id="demo-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Interactive Demos</h2>
                </div>
                <p>Explore the capabilities of the Senars3 cognitive system with these pre-built demos. Click on any demo to see how the system processes different types of input.</p>
                
                <div class="demo-grid">
                    <div class="demo-card" data-demo="medical">
                        <h3>Medical Diagnosis</h3>
                        <p>See how the system can help diagnose medical conditions based on symptoms.</p>
                    </div>
                    <div class="demo-card" data-demo="scientific">
                        <h3>Scientific Hypothesis</h3>
                        <p>Watch the system generate and evaluate scientific hypotheses.</p>
                    </div>
                    <div class="demo-card" data-demo="business">
                        <h3>Business Strategy</h3>
                        <p>Observe how the system can analyze market conditions and recommend strategies.</p>
                    </div>
                    <div class="demo-card" data-demo="cybersecurity">
                        <h3>Cybersecurity Analysis</h3>
                        <p>See how the system can identify and analyze potential security threats.</p>
                    </div>
                    <div class="demo-card" data-demo="environmental">
                        <h3>Environmental Science</h3>
                        <p>Explore the system's ability to analyze environmental data and suggest solutions.</p>
                    </div>
                    <div class="demo-card" data-demo="educational">
                        <h3>Educational Planning</h3>
                        <p>See how the system can create personalized learning plans.</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Demo Results</h2>
                </div>
                <div id="demo-output">
                    <p>Select a demo above to see the system in action.</p>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="custom-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Custom Input</h2>
                </div>
                <p>Enter your own text for the cognitive system to process. Try statements, questions, commands, or complex requests.</p>
                
                <div class="input-group">
                    <textarea id="user-input" placeholder="Example: My cat seems sick after eating chocolate. What should I do?"></textarea>
                </div>
                <button id="process-btn" class="btn">Process Input (Ctrl+Enter)</button>
                
                <div id="custom-output" class="output-section" style="margin-top: 20px; display: none;">
                    <h3>Processing Results</h3>
                    <div id="custom-results"></div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="system-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">System Status</h2>
                </div>
                <p>Real-time information about the cognitive system's operation.</p>
                
                <div class="system-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="agenda-count">0</div>
                        <div class="stat-label">Agenda Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="atom-count">0</div>
                        <div class="stat-label">Knowledge Atoms</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="item-count">0</div>
                        <div class="stat-label">Cognitive Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="processed-count">0</div>
                        <div class="stat-label">Inputs Processed</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>System Components</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                        <span class="btn btn-secondary" style="cursor: default;">Agenda</span>
                        <span class="btn btn-secondary" style="cursor: default;">World Model</span>
                        <span class="btn btn-secondary" style="cursor: default;">Attention Module</span>
                        <span class="btn btn-secondary" style="cursor: default;">Resonance Module</span>
                        <span class="btn btn-secondary" style="cursor: default;">Schema Matcher</span>
                        <span class="btn btn-secondary" style="cursor: default;">Belief Revision Engine</span>
                        <span class="btn btn-secondary" style="cursor: default;">Goal Tree Manager</span>
                        <span class="btn btn-secondary" style="cursor: default;">Reflection Loop</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="help-tab">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Help & Examples</h2>
                </div>
                <p>Learn how to effectively use the Senars3 cognitive system with these examples and guidelines.</p>
                
                <h3>Input Types</h3>
                <p>The system can process different types of input:</p>
                <ul>
                    <li><strong>Statements</strong>: Factual information like "Chocolate is toxic to dogs"</li>
                    <li><strong>Questions</strong>: Queries that require answers like "What should I do if my cat ate chocolate?"</li>
                    <li><strong>Commands</strong>: Action requests like "Search for information about pet nutrition"</li>
                    <li><strong>Goals</strong>: Complex objectives like "Diagnose why my plant is wilting"</li>
                    <li><strong>Complex Requests</strong>: Multi-part requests like "Create a comprehensive health plan for my pet"</li>
                </ul>
                
                <h3 style="margin-top: 20px;">Best Practices</h3>
                <ul>
                    <li>Be specific and clear in your input</li>
                    <li>Use domain-specific terminology when possible</li>
                    <li>Break down complex requests into smaller parts if needed</li>
                    <li>Check the system status to monitor performance</li>
                </ul>
                
                <h3 style="margin-top: 20px;">Keyboard Shortcuts</h3>
                <ul>
                    <li><strong>Ctrl+Enter</strong>: Process input in the Custom Input tab</li>
                    <li><strong>Tab</strong>: Switch between different interface sections</li>
                </ul>
                
                <h3 style="margin-top: 20px;">Understanding Output</h3>
                <p>The system categorizes output into three types:</p>
                <div style="display: flex; gap: 20px; margin-top: 10px;">
                    <div style="flex: 1; padding: 15px; background: #e8f5e9; border-left: 4px solid #2ecc71; border-radius: 4px;">
                        <strong>Beliefs</strong>
                        <p>Factual information the system has learned or inferred</p>
                    </div>
                    <div style="flex: 1; padding: 15px; background: #fef0e6; border-left: 4px solid #e74c3c; border-radius: 4px;">
                        <strong>Goals</strong>
                        <p>Tasks or objectives the system needs to accomplish</p>
                    </div>
                    <div style="flex: 1; padding: 15px; background: #fff8e1; border-left: 4px solid #f39c12; border-radius: 4px;">
                        <strong>Queries</strong>
                        <p>Questions that require answers or exploration</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Senars3 Cognitive System - A verifiable, goal-directed, and self-reflective reasoning system</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">For command-line access, run: <code>npm start</code></p>
        </footer>
    </div>
    
    <script>
        // DOM elements
        const notificationContainer = document.getElementById('notification-container');
        const statusEl = document.getElementById('connection-status');
        const agendaSizeEl = document.getElementById('agenda-size');
        const demoCards = document.querySelectorAll('.demo-card');
        const demoOutput = document.getElementById('demo-output');
        const userInput = document.getElementById('user-input');
        const processBtn = document.getElementById('process-btn');
        const customOutput = document.getElementById('custom-output');
        const customResults = document.getElementById('custom-results');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // System stats elements
        const agendaCountEl = document.getElementById('agenda-count');
        const atomCountEl = document.getElementById('atom-count');
        const itemCountEl = document.getElementById('item-count');
        const processedCountEl = document.getElementById('processed-count');
        
        // WebSocket connection
        let ws = null;
        let messageId = 1;
        let processedInputs = 0;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        
        // Demo inputs
        const demoInputs = {
            medical: "A 45-year-old male presents with chest pain, shortness of breath, and diaphoresis that started 30 minutes ago. He has a history of hypertension and smoking. What is the most likely diagnosis and immediate treatment?",
            scientific: "Design an experiment to test the hypothesis that increased CO2 levels lead to faster plant growth. Include control groups, variables, and measurement methods.",
            business: "A tech startup is losing market share to competitors. Analyze their position and recommend strategies for growth in a competitive market.",
            cybersecurity: "Our network monitoring system detected unusual traffic patterns from an internal server to an external IP address at 3 AM. Analyze the potential threat and recommend actions.",
            environmental: "Local water quality tests show increased nitrogen levels in a river near agricultural areas. Assess the environmental impact and propose mitigation strategies.",
            educational: "Create a personalized learning plan for a 12-year-old student who excels in mathematics but struggles with reading comprehension."
        };
        
        // Connect to WebSocket server
        function connectWebSocket() {
            // Use the same host as the web page but on port 8080
            const wsUrl = `ws://${window.location.hostname}:8080`;
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                console.log('Connected to WebSocket server');
                reconnectAttempts = 0;
                updateConnectionStatus(true);
                showNotification('Connected to cognitive system', 'success');
                // Request system status
                requestSystemStatus();
            };
            
            ws.onmessage = function(event) {
                try {
                    const message = JSON.parse(event.data);
                    handleMessage(message);
                } catch (error) {
                    console.error('Error parsing message:', error);
                    showNotification('Error parsing server response', 'error');
                }
            };
            
            ws.onclose = function() {
                console.log('Disconnected from WebSocket server');
                updateConnectionStatus(false);
                
                // Attempt to reconnect with exponential backoff
                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000); // Max 30 seconds
                    showNotification(`Disconnected from cognitive system. Retrying in ${delay/1000} seconds... (Attempt ${reconnectAttempts}/${maxReconnectAttempts})`, 'error');
                    
                    setTimeout(connectWebSocket, delay);
                } else {
                    showNotification('Failed to reconnect after multiple attempts. Please refresh the page.', 'error');
                }
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
                showNotification('Connection error: ' + (error.message || 'Unknown error'), 'error');
            };
        }
        
        // Update connection status display
        function updateConnectionStatus(connected) {
            if (connected) {
                statusEl.innerHTML = '<span class="status-indicator status-connected"></span> Connected';
            } else {
                statusEl.innerHTML = '<span class="status-indicator status-disconnected"></span> Disconnected';
            }
        }
        
        // Show notification
        function showNotification(message, type) {
            // Remove any existing notifications of the same type
            const existingNotifications = document.querySelectorAll(`.notification.${type}`);
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message; // Use innerHTML to support HTML content
            
            notificationContainer.appendChild(notification);
            
            // Auto-remove success notifications after 3 seconds, others after 10 seconds
            const timeout = type === 'success' ? 3000 : 10000;
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, timeout);
        }
        
        // Handle incoming messages
        function handleMessage(message) {
            console.log('Received message:', message);
            
            switch (message.type) {
                case 'event':
                    handleEvent(message);
                    break;
                case 'response':
                    handleResponse(message);
                    break;
                case 'error':
                    handleError(message);
                    break;
                case 'welcome':
                    console.log('Welcome message:', message.payload);
                    break;
                default:
                    console.log('Unknown message type:', message.type);
            }
        }
        
        // Handle event messages
        function handleEvent(message) {
            switch (message.method) {
                case 'inputProcessed':
                    displayResults(message.payload.input, message.payload.cognitiveItems);
                    processedInputs++;
                    processedCountEl.textContent = processedInputs;
                    // Update agenda size
                    requestSystemStatus();
                    break;
                case 'inputProcessingError':
                    showNotification('Error processing input: ' + (message.payload.error || 'Unknown error'), 'error');
                    resetUIState();
                    demoOutput.innerHTML = '<p class="error">Error processing input. Please try again.</p>';
                    break;
                default:
                    console.log('Unknown event:', message.method);
            }
        }
        
        // Handle response messages
        function handleResponse(message) {
            // Handle system status response
            if (message.payload && message.payload.statistics) {
                const stats = message.payload.statistics;
                agendaCountEl.textContent = stats.agendaSize || 0;
                atomCountEl.textContent = stats.atomCount || 0;
                itemCountEl.textContent = stats.itemCount || 0;
                agendaSizeEl.textContent = stats.agendaSize || 0;
            }
        }
        
        // Handle error messages
        function handleError(message) {
            const errorMessage = message.error ? `${message.error.code}: ${message.error.message}` : 'Unknown error';
            showNotification(`Error: ${errorMessage}`, 'error');
            resetUIState();
            
            // Log error to console for debugging
            console.error('System error:', message);
        }
        
        // Reset UI state after processing
        function resetUIState() {
            processBtn.disabled = false;
            demoCards.forEach(card => card.style.pointerEvents = 'auto');
        }
        
        // Send message to WebSocket server
        function sendWebSocketMessage(target, method, payload) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                const message = {
                    id: 'msg-' + messageId++,
                    type: 'request',
                    target: target,
                    method: method,
                    payload: payload
                };
                
                ws.send(JSON.stringify(message));
                return true;
            } else {
                showNotification('Not connected to server. Please wait for reconnection or refresh the page.', 'error');
                return false;
            }
        }
        
        // Request system status
        function requestSystemStatus() {
            sendWebSocketMessage('worldModel', 'getStatistics', {});
        }
        
        // Process input
        function processInput(input) {
            // Validate input
            if (!input || input.trim().length === 0) {
                showNotification('Please enter some text to process', 'warning');
                return false;
            }
            
            const trimmedInput = input.trim();
            
            if (trimmedInput.length < 3) {
                showNotification('Input too short. Please enter at least 3 characters.', 'warning');
                return false;
            }
            
            if (trimmedInput.length > 10000) {
                showNotification('Input too long. Please limit input to 10,000 characters.', 'warning');
                return false;
            }
            
            // Disable buttons during processing
            processBtn.disabled = true;
            demoCards.forEach(card => card.style.pointerEvents = 'none');
            
            // Show loading indicator
            demoOutput.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Processing input...</p>
                    <p style="font-size: 0.9em; margin-top: 10px;">This may take a few moments</p>
                    <p style="font-size: 0.8em; margin-top: 5px; opacity: 0.8;">Input: "${trimmedInput}"</p>
                </div>
            `;
            
            // Send message to WebSocket server
            const success = sendWebSocketMessage('perception', 'processInput', { input: trimmedInput });
            
            if (!success) {
                resetUIState();
            }
            
            return success;
        }
        
        // Display results in the output container
        function displayResults(input, results) {
            // Clear previous output
            demoOutput.innerHTML = '';
            
            if (!results || results.length === 0) {
                demoOutput.innerHTML = '<p>No cognitive items were extracted from your input. Try rephrasing or providing more specific information.</p>';
                resetUIState();
                return;
            }
            
            // Add input header
            const inputHeader = document.createElement('div');
            inputHeader.innerHTML = `<h3>Input: "${input}"</h3>`;
            demoOutput.appendChild(inputHeader);
            
            // Display each result
            results.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = `output-item ${item.type.toLowerCase()}`;
                
                // Format truth value if available
                let truthInfo = '';
                if (item.truth) {
                    truthInfo = `Frequency: ${item.truth.frequency.toFixed(2)}, Confidence: ${item.truth.confidence.toFixed(2)}`;
                }
                
                // Format attention value if available
                let attentionInfo = '';
                if (item.attention) {
                    attentionInfo = `Priority: ${item.attention.priority.toFixed(2)}, Durability: ${item.attention.durability.toFixed(2)}`;
                }
                
                // Format metadata if available
                let metaInfo = '';
                if (item.meta) {
                    metaInfo = `Domain: ${item.meta.domain || 'general'}${item.meta.source ? `, Source: ${item.meta.source}` : ''}`;
                }
                
                itemEl.innerHTML = `
                    <div class="item-type">${item.type}</div>
                    <div class="item-content">${item.label || 'No content'}</div>
                    ${truthInfo ? `<div class="item-meta">${truthInfo}</div>` : ''}
                    ${attentionInfo ? `<div class="item-meta">${attentionInfo}</div>` : ''}
                    ${metaInfo ? `<div class="item-meta">${metaInfo}</div>` : ''}
                `;
                
                demoOutput.appendChild(itemEl);
            });
            
            // Show success notification
            showNotification(`Processed input and extracted ${results.length} cognitive item(s)`, 'success');
            
            // Re-enable buttons
            resetUIState();
        }
        
        // Set up event listeners
        processBtn.addEventListener('click', function() {
            const input = userInput.value.trim();
            processInput(input);
        });
        
        // Also process on Ctrl+Enter
        userInput.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                const input = userInput.value.trim();
                processInput(input);
            }
        });
        
        // Add event listeners to demo cards
        demoCards.forEach(card => {
            card.addEventListener('click', function() {
                const demoType = this.getAttribute('data-demo');
                const input = demoInputs[demoType];
                
                if (input) {
                    // Update the custom input field with the demo input
                    userInput.value = input;
                    // Process the input
                    processInput(input);
                }
            });
        });
        
        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Show corresponding content
                const tabName = this.getAttribute('data-tab');
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // If system tab is activated, refresh stats
                if (tabName === 'system') {
                    requestSystemStatus();
                }
            });
        });
        
        // Initialize
        window.addEventListener('load', () => {
            // Connect to WebSocket server
            connectWebSocket();
            
            // Set up periodic status updates (every 10 seconds)
            setInterval(() => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    requestSystemStatus();
                }
            }, 10000);
            
            // Set initial example in the input field
            userInput.value = "My cat seems sick after eating chocolate. What should I do?";
        });
    </script>
</body>
</html>