<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senars3 Cognitive System - Legacy Interface</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .description {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .notice {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }
        
        .input-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .output-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .output-item {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
        }
        
        .output-item.belief {
            border-left-color: #2ecc71;
        }
        
        .output-item.goal {
            border-left-color: #e74c3c;
        }
        
        .output-item.query {
            border-left-color: #f39c12;
        }
        
        .item-type {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8em;
            margin-bottom: 5px;
        }
        
        .item-content {
            margin-bottom: 10px;
        }
        
        .item-meta {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: #2c3e50;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-connected {
            background-color: #2ecc71;
        }
        
        .status-disconnected {
            background-color: #e74c3c;
        }
        
        .examples {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .examples h3 {
            margin-top: 0;
        }
        
        .examples ul {
            padding-left: 20px;
        }
        
        .examples li {
            margin-bottom: 8px;
        }
        
        .help-section {
            background: #fef9e7;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .notification {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .notification.error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .btn-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 15px;
            background-color: #2c3e50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        
        .btn-link:hover {
            background-color: #1a2530;
        }
    </style>
</head>
<body>
    <header>
        <h1>Senars3 Cognitive System</h1>
        <p class="description">A verifiable, goal-directed, and self-reflective reasoning system</p>
    </header>
    
    <div class="notice">
        <strong>Notice:</strong> This is the legacy web interface. For a more advanced experience with interactive demos, 
        please visit the <a href="/">enhanced interface</a>.
    </div>
    
    <div class="status-bar">
        <div>
            Connection Status: 
            <span id="connection-status">
                <span class="status-indicator status-disconnected"></span>
                Disconnected
            </span>
        </div>
        <div>Agenda Size: <span id="agenda-size">0</span></div>
    </div>
    
    <div id="notification-container"></div>
    
    <section class="input-section">
        <h2>Input</h2>
        <p>Enter a statement or question for the cognitive system to process:</p>
        <textarea id="user-input" placeholder="Example: My cat seems sick after eating chocolate. What should I do?"></textarea>
        <button id="process-btn">Process Input</button>
    </section>
    
    <section class="output-section">
        <h2>Output</h2>
        <div id="output-container">
            <p>Processing results will appear here...</p>
        </div>
    </section>
    
    <section class="examples">
        <h3>Example Inputs</h3>
        <ul>
            <li>My cat seems sick after eating chocolate. What should I do?</li>
            <li>Can you search for information about pet nutrition?</li>
            <li>Diagnose why my plant is wilting</li>
            <li>Create a comprehensive health plan for my pet including diet, exercise, and medical checkups</li>
        </ul>
    </section>
    
    <section class="help-section">
        <h3>How It Works</h3>
        <p>The Senars3 cognitive system processes natural language input by:</p>
        <ol>
            <li><strong>Perceiving</strong> - Converting text into cognitive items (beliefs, goals, queries)</li>
            <li><strong>Contextualizing</strong> - Finding relevant knowledge in its memory</li>
            <li><strong>Reasoning</strong> - Applying cognitive schemas to generate new insights</li>
            <li><strong>Acting</strong> - Executing goals like searching or diagnosing</li>
            <li><strong>Learning</strong> - Updating its knowledge base with new information</li>
        </ol>
    </section>
    
    <a href="/" class="btn-link">Go to Enhanced Interface</a>
    
    <script>
        // DOM elements
        const userInput = document.getElementById('user-input');
        const processBtn = document.getElementById('process-btn');
        const outputContainer = document.getElementById('output-container');
        const statusEl = document.getElementById('connection-status');
        const agendaSizeEl = document.getElementById('agenda-size');
        const notificationContainer = document.getElementById('notification-container');
        
        // WebSocket connection
        let ws = null;
        let messageId = 1;
        
        // Connect to WebSocket server
        function connectWebSocket() {
            // Use the same host as the web page but on port 8080
            const wsUrl = `ws://${window.location.hostname}:8080`;
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                console.log('Connected to WebSocket server');
                updateConnectionStatus(true);
                showNotification('Connected to cognitive system', 'success');
            };
            
            ws.onmessage = function(event) {
                try {
                    const message = JSON.parse(event.data);
                    handleMessage(message);
                } catch (error) {
                    console.error('Error parsing message:', error);
                }
            };
            
            ws.onclose = function() {
                console.log('Disconnected from WebSocket server');
                updateConnectionStatus(false);
                showNotification('Disconnected from cognitive system. Retrying in 5 seconds...', 'error');
                
                // Attempt to reconnect after 5 seconds
                setTimeout(connectWebSocket, 5000);
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
                showNotification('Connection error: ' + error.message, 'error');
            };
        }
        
        // Update connection status display
        function updateConnectionStatus(connected) {
            if (connected) {
                statusEl.innerHTML = '<span class="status-indicator status-connected"></span> Connected';
            } else {
                statusEl.innerHTML = '<span class="status-indicator status-disconnected"></span> Disconnected';
            }
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'error' : ''}`;
            notification.textContent = message;
            
            notificationContainer.appendChild(notification);
            
            // Remove notification after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // Handle incoming messages
        function handleMessage(message) {
            console.log('Received message:', message);
            
            switch (message.type) {
                case 'event':
                    handleEvent(message);
                    break;
                case 'response':
                    handleResponse(message);
                    break;
                case 'error':
                    handleError(message);
                    break;
                case 'welcome':
                    console.log('Welcome message:', message.payload);
                    break;
            }
        }
        
        // Handle event messages
        function handleEvent(message) {
            switch (message.method) {
                case 'inputProcessed':
                    displayResults(message.payload.input, message.payload.cognitiveItems);
                    break;
                case 'inputProcessingError':
                    showNotification('Error processing input: ' + message.payload.error, 'error');
                    processBtn.disabled = false;
                    break;
                default:
                    console.log('Unknown event:', message.method);
            }
        }
        
        // Handle response messages
        function handleResponse(message) {
            // For now, we're not expecting specific responses from our requests
            // In a more advanced implementation, we might handle specific responses here
        }
        
        // Handle error messages
        function handleError(message) {
            showNotification(`Error (${message.error.code}): ${message.error.message}`, 'error');
            processBtn.disabled = false;
        }
        
        // Process input when button is clicked
        function processInput() {
            const input = userInput.value.trim();
            if (!input) {
                showNotification('Please enter some text to process', 'error');
                return;
            }
            
            if (input.length < 3) {
                showNotification('Input too short. Please enter at least 3 characters.', 'error');
                return;
            }
            
            if (input.length > 10000) {
                showNotification('Input too long. Please limit input to 10,000 characters.', 'error');
                return;
            }
            
            // Disable button during processing
            processBtn.disabled = true;
            
            // Clear previous output
            outputContainer.innerHTML = '<p>Processing input...</p>';
            
            // Send message to WebSocket server
            if (ws && ws.readyState === WebSocket.OPEN) {
                const message = {
                    id: 'msg-' + messageId++,
                    type: 'request',
                    target: 'perception',
                    method: 'processInput',
                    payload: {
                        input: input
                    }
                };
                
                ws.send(JSON.stringify(message));
            } else {
                showNotification('Not connected to server. Please wait for reconnection.', 'error');
                processBtn.disabled = false;
            }
        }
        
        // Display results in the output container
        function displayResults(input, results) {
            // Clear previous output
            outputContainer.innerHTML = '';
            
            if (!results || results.length === 0) {
                outputContainer.innerHTML = '<p>No cognitive items were extracted from your input. Try rephrasing.</p>';
                processBtn.disabled = false;
                return;
            }
            
            // Display each result
            results.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = `output-item ${item.type.toLowerCase()}`;
                
                // Format truth value if available
                let truthInfo = '';
                if (item.truth) {
                    truthInfo = `Frequency: ${item.truth.frequency.toFixed(2)}, Confidence: ${item.truth.confidence.toFixed(2)}`;
                }
                
                // Format attention value if available
                let attentionInfo = '';
                if (item.attention) {
                    attentionInfo = `Priority: ${item.attention.priority.toFixed(2)}, Durability: ${item.attention.durability.toFixed(2)}`;
                }
                
                itemEl.innerHTML = `
                    <div class="item-type">${item.type}</div>
                    <div class="item-content">${item.label || item.content || 'No content'}</div>
                    ${truthInfo ? `<div class="item-meta">${truthInfo}</div>` : ''}
                    ${attentionInfo ? `<div class="item-meta">${attentionInfo}</div>` : ''}
                    ${item.meta ? `<div class="item-meta">Meta: ${JSON.stringify(item.meta)}</div>` : ''}
                `;
                
                outputContainer.appendChild(itemEl);
            });
            
            // Re-enable button
            processBtn.disabled = false;
        }
        
        // Set up event listeners
        processBtn.addEventListener('click', processInput);
        
        // Also process on Ctrl+Enter
        userInput.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                processInput();
            }
        });
        
        // Initialize with an example
        window.addEventListener('load', () => {
            userInput.value = "My cat seems sick after eating chocolate. What should I do?";
            
            // Connect to WebSocket server
            connectWebSocket();
        });
    </script>
</body>
</html>